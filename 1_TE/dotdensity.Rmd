---
title: 'Técnica básica: Mapa de densidad de puntos (dot density map)'
author: "Laia S. Quichua Cisneros"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
# Silenciar avisos/mensajes en TODOS los chunks
knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  fig.width = 8,
  fig.height = 6
)

# Cargar paquetes sin mensajes de startup
suppressPackageStartupMessages({
  suppressMessages({
    library(tidycensus)   # Acceder al dataset
    library(tidyverse)
    library(tmap)
    library(tigris)
    library(sf)
  })
})

# Opciones de tigris/sf sin ruido
options(tigris_use_cache = TRUE)

# tmap_mode imprime un mensaje por defecto: suprimirlo
suppressMessages(tmap_mode("plot"))
```

Prerequisitos para consumir datos vía API:
```{r}
# Instalar Census API:
# https://api.census.gov/data/key_signup.html
#census_api_key("a7d48140cc431e9fdbd0f12c6c1e997caab2bbc4", install=T, overwrite = T)
```

Extracción de la informacion de census api del estado de Florida, concretamente del condado de Miami:
```{r}
# Miami-Dade
md_race = get_decennial(
  geography = "county",
  state = "FL",
  county = "Miami-Dade",
  variables = c(
    Hispanic = "P2_002N",
    White = "P2_005N",
    Black = "P2_006N",
    Asian = "P2_008N"
  ),
  year = 2020,
  geometry = TRUE # Get shape field information
)
```

Se convierten a puntos dispersos para trazar, donde un punto representa 1000 personas:
```{r}
# 
md_dots = as_dot_density(
  md_race,
  value = "value",
  values_per_dot = 1000,
  group = "variable"
)
```

Visualización de Técnica básica: Mapa de densidad de puntos (dot density map)
```{r}
background_tracts = filter(md_race, variable == "White")

# dot density plot
tm_shape(background_tracts) + 
  tm_polygons(col = "white", 
              border.col = "grey") + 
  tm_shape(md_dots) +
  tm_dots(col = "variable", 
          palette = "Set1",
          size = 0.25, 
          title = "1 dot = 1,000 people") + 
  tm_layout(legend.outside = TRUE,
            title = "Ethnicity,\n2020 US Census", scale = 1.5)
```

Se ha probado con otros estados y condados, pero el resultado de Miami es el más adecuado para mostrar una realidad conocida: Mi gente Latino! (Jeniffer López)


Créditos al tutorial: Dot Density Map in R Using Census Data - https://www.youtube.com/watch?v=zjgqIAa5_wE